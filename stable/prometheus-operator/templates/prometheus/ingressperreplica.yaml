{{- if and .Values.prometheus.enabled .Values.prometheus.servicePerReplica.enabled .Values.prometheus.ingressPerReplica.enabled }}
{{- $count := .Values.prometheus.prometheusSpec.replicas | int -}}
{{- $servicePort := 9090 -}}
{{- $ingressValues := .Values.prometheus.ingressPerReplica -}}
{{ range $i, $e := until $count }}
---
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
{{- if $ingressValues.annotations }}
  annotations:
{{ toYaml $ingressValues.annotations | indent 4 }}
{{- end }}
  name: {{ include "prometheus-operator.fullname" $ }}-prometheus-{{ $i }}
  labels:
    app: {{ include "prometheus-operator.name" $ }}-prometheus
{{ include "prometheus-operator.labels" $ | indent 4 }}
{{- if $ingressValues.labels }}
{{ toYaml $ingressValues.labels | indent 4 }}
{{- end }}
spec:
  rules:
    - host: {{ $ingressValues.hostPrefix }}-{{ $i }}.{{ $ingressValues.hostDomain }}
      http:
        paths:
  {{- range $p := $ingressValues.paths }}
          - path: {{ tpl $p $ }}
            backend:
              serviceName: {{ include "prometheus-operator.fullname" $ }}-prometheus-{{ $i }}
              servicePort: {{ $servicePort }}
  {{- end -}}
  {{- if $ingressValues.tlsSecretName }}
  tls:
    - hosts:
        - {{ $ingressValues.hostPrefix }}-{{ $i }}.{{ $ingressValues.hostDomain }}
      secretName: {{ $ingressValues.tlsSecretName }}
  {{- end }}
{{- end -}}
{{- end -}}

{{ $elasticsearchName :=  include "elasticsearch.name" . }}
{{ $elasticsearchFullName :=  include "elasticsearch.fullname" . }}
{{ $releaseName := .Release.Name }}
{{ $releaseService := .Release.Service }}
{{ $chartName := .Chart.Name }}
{{ $chartVersion := .Chart.Version }}
{{- range $data := .Values.dataTypes }}
{{- if $data.podDisruptionBudget.enabled }}
apiVersion: policy/v1beta1
kind: PodDisruptionBudget
metadata:
  labels:
    app: {{ $elasticsearchName }}
    chart: {{ $chartName }}-{{ $chartVersion }}
    component: "{{ $data.name }}"
    heritage: {{ $releaseService }}
    release: {{ $releaseName }}
  name: {{ $elasticsearchFullName }}-{{ $data.name }}
spec:
{{- if $data.podDisruptionBudget.minAvailable }}
  minAvailable: {{ $data.podDisruptionBudget.minAvailable }}
{{- end }}
{{- if $data.podDisruptionBudget.maxUnavailable }}
  maxUnavailable: {{ $data.podDisruptionBudget.maxUnavailable }}
{{- end }}
  selector:
    matchLabels:
      app: {{ $elasticsearchName }}
      component: "{{ $data.name }}"
      release: {{ $releaseName }}
{{- end }}
{{- end }}

{{- if and (not .Values.config.existingSecret) (.Values.proxyVarsAsSecrets) }}
{{- if or .Values.config.secretConfig.clientID.write .Values.config.secretConfig.clientSecret.write .Values.config.secretConfig.cookieSecret.write }}
{{- $global := . }}
{{- range $name := list (include "oauth2-proxy.clientIDSecretName" .) (include "oauth2-proxy.clientSecretSecretName" .) (include "oauth2-proxy.cookieSecretSecretName" .) "" | uniq }}
---
{{- with $global }}
{{- if ne (include "oauth2-proxy.entriesInSecret" (list $name .)) "" }}
apiVersion: v1
kind: Secret
metadata:
  labels:
    app: {{ template "oauth2-proxy.name" . }}
    chart: {{ template "oauth2-proxy.chart" . }}
    heritage: {{ .Release.Service }}
    release: {{ .Release.Name }}
  name: {{ $name }}
type: Opaque
data:
{{- if and .Values.config.secretConfig.cookieSecret.write (eq $name (include "oauth2-proxy.cookieSecretSecretName" .)) }}
  {{ .Values.config.secretConfig.cookieSecret.keyName }}: {{ .Values.config.cookieSecret | b64enc | quote }}
{{- end -}}
{{- if and .Values.config.secretConfig.clientSecret.write (eq $name (include "oauth2-proxy.clientSecretSecretName" .)) }}
  {{ .Values.config.secretConfig.clientSecret.keyName }}: {{ .Values.config.clientSecret | b64enc | quote }}
{{- end -}}
{{- if and .Values.config.secretConfig.clientID.write (eq $name (include "oauth2-proxy.clientIDSecretName" .)) }}
  {{ .Values.config.secretConfig.clientID.keyName }}: {{ .Values.config.clientID | b64enc | quote }}
{{- end -}}
{{- end -}}
{{- end -}}
{{- end -}}
{{- end -}}
{{- end -}}

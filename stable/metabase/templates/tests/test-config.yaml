apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "fullname" . }}-tests
data:
  run.sh: |-
    @test "Testing Metabase respond to HTTP request" {
      response_code=$(curl -sLI --max-time 5 -o /dev/null -w "%{http_code}" {{ .Values.listen.host }}:{{ .Values.listen.port }})
      if [ "$response_code" -eq "200" ]; then
        echo "{{ .Release.Name }}-tests OK. Metabase responded with HTTP code $response_code."
      else
        echo "{{ .Release.Name }}-tests ERROR. Metabase responded with HTTP code $response_code."
        exit 1
      fi
    }

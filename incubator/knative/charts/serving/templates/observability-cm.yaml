apiVersion: v1
data:
  _example: "################################\n#                              #\n#    EXAMPLE CONFIGURATION     #\n#                              #\n################################\n\n# This block is not actually functional configuration,\n# but serves to illustrate the available configuration\n# options and document them in a way that is accessible\n# to users that `kubectl edit` this config map.\n#\n# These sample configuration options may be copied out of\n# this block and unindented to actually change the configuration.\n\n# logging.enable-var-log-collection defaults to false.\n# A fluentd sidecar will be set up to collect var log if\n# this flag is true.\nlogging.enable-var-log-collection: false\n\n# logging.fluentd-sidecar-image provides the fluentd sidecar image\n# to inject as a sidecar to collect logs from /var/log.\n# Must be presented if logging.enable-var-log-collection is true.\nlogging.fluentd-sidecar-image: k8s.gcr.io/fluentd-elasticsearch:v2.0.4\n\n# logging.fluentd-sidecar-output-config\
    \ provides the configuration\n# for the fluentd sidecar, which will be placed into a configmap and\n# mounted into the fluentd sidecar image.\nlogging.fluentd-sidecar-output-config: |\n  # Parse json log before sending to Elastic Search\n  <filter **>\n    @type parser\n    key_name log\n    <parse>\n      @type multi_format\n      <pattern>\n        format json\n        time_key fluentd-time # fluentd-time is reserved for structured logs\n        time_format %Y-%m-%dT%H:%M:%S.%NZ\n      </pattern>\n      <pattern>\n        format none\n        message_key log\n      </pattern>\n    </parse>\n  </filter>\n  # Send to Elastic Search\n  <match **>\n    @id elasticsearch\n    @type elasticsearch\n    @log_level info\n    include_tag_key true\n    # Elasticsearch service is in monitoring namespace.\n    host elasticsearch-logging.knative-monitoring\n    port 9200\n    logstash_format true\n    <buffer>\n      @type file\n      path /var/log/fluentd-buffers/kubernetes.system.buffer\n    \
    \  flush_mode interval\n      retry_type exponential_backoff\n      flush_thread_count 2\n      flush_interval 5s\n      retry_forever\n      retry_max_interval 30\n      chunk_limit_size 2M\n      queue_limit_length 8\n      overflow_action block\n    </buffer>\n  </match>\n\n# logging.revision-url-template provides a template to use for producing the\n# logging URL that is injected into the status of each Revision.\n# This value is what you might use the the Knative monitoring bundle, and provides\n# access to Kibana after setting up kubectl proxy.\nlogging.revision-url-template: |\n  http://localhost:8001/api/v1/namespaces/knative-monitoring/services/kibana-logging/proxy/app/kibana#/discover?_a=(query:(match:(kubernetes.labels.knative-dev%2FrevisionUID:(query:'${REVISION_UID}',type:phrase))))\n\n# If non-empty, this enables queue proxy writing request logs to stdout.\n# The value determines the shape of the request logs and it must be a valid go text/template.\n# It is important to\
    \ keep this as a single line. Multiple lines are parsed as separate entities\n# by most collection agents and will split the request logs into multiple records.\n#\n# The following fields and functions are available to the template:\n#\n# Request: An http.Request (see https://golang.org/pkg/net/http/#Request)\n# representing an HTTP request received by the server.\n#\n# Response:\n# struct {\n#   Code    int       // HTTP status code (see https://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml)\n#   Size    int       // An int representing the size of the response.\n#   Latency float64   // A float64 representing the latency of the response in seconds.\n# }\n#\n# Revision:\n# struct {\n#   Name          string  // Knative revision name\n#   Namespace     string  // Knative revision namespace\n#   Service       string  // Knative service name\n#   Configuration string  // Knative configuration name\n#   PodName       string  // Name of the pod hosting the revision\n\
    #   PodIP         string  // IP of the pod hosting the revision\n# }\n#\nlogging.request-log-template: '{\"httpRequest\": {\"requestMethod\": \"{{"{{"}}.Request.Method{{"}}"}}\", \"requestUrl\": \"{{"{{"}}js .Request.RequestURI{{"}}"}}\", \"requestSize\": \"{{"{{"}}.Request.ContentLength{{"}}"}}\", \"status\": {{"{{"}}.Response.Code{{"}}"}}, \"responseSize\": \"{{"{{"}}.Response.Size{{"}}"}}\", \"userAgent\": \"{{"{{"}}js .Request.UserAgent{{"}}"}}\", \"remoteIp\": \"{{"{{"}}js .Request.RemoteAddr{{"}}"}}\", \"serverIp\": \"{{"{{"}}.Revision.PodIP{{"}}"}}\", \"referer\": \"{{"{{"}}js .Request.Referer{{"}}"}}\", \"latency\": \"{{"{{"}}.Response.Latency{{"}}"}}s\", \"protocol\": \"{{"{{"}}.Request.Proto{{"}}"}}\"}, \"traceId\": \"{{"{{"}}index .Request.Header \"X-B3-Traceid\"}}\"}'\n\n# metrics.backend-destination field specifies the system metrics destination.\n# It supports either prometheus (the default) or stackdriver.\n# Note: Using stackdriver will incur additional charges\nmetrics.backend-destination: prometheus\n\n# metrics.request-metrics-backend-destination specifies the request metrics\n# destination. If non-empty,\
    \ it enables queue proxy to send request metrics.\n# Currently supported values: prometheus, stackdriver.\nmetrics.request-metrics-backend-destination: prometheus\n\n# metrics.stackdriver-project-id field specifies the stackdriver project ID. This\n# field is optional. When running on GCE, application default credentials will be\n# used if this field is not provided.\nmetrics.stackdriver-project-id: \"<your stackdriver project id>\"\n\n# metrics.allow-stackdriver-custom-metrics indicates whether it is allowed to send metrics to\n# Stackdriver using \"global\" resource type and custom metric type if the\n# metrics are not supported by \"knative_revision\" resource type. Setting this\n# flag to \"true\" could cause extra Stackdriver charge.\n# If metrics.backend-destination is not Stackdriver, this is ignored.\nmetrics.allow-stackdriver-custom-metrics: \"false\"\n"
kind: ConfigMap
metadata:
  labels: {{ include "labels" . | nindent 4 }} {{ "serving.knative.dev/release: \"devel\"" | nindent 4 }} {{ cat "app:" .Chart.Name | nindent 4 }}
  name: config-observability
  namespace: knative-serving

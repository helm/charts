apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ template "fullname" . }}
  labels:
    app: {{ template "fullname" . }}
    chart: "{{ .Chart.Name }}-{{ .Chart.Version }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"
data:
  server.debug.is.enabled: "true"

  # You'll probably want to leave this alone, but you can point to external
  #See http://readme.drone.io/admin/database-engines/ for possible values here.
  server.database.driver: {{ .Values.server.database.driver | quote }}
  server.database.config: {{ .Values.server.database.config | quote }}

  {{ if .Values.ssl.enabled }}
  server.ssl.key: /ssl/tls.crt
  server.ssl.cert: /ssl/tls.key
  {{ end }}

  server.is.open: {{ .Values.server.open | quote }}
  server.orgs.list:  {{ .Values.server.orgs | quote }}
  server.admin.list: {{ .Values.server.admin | quote }}
  server.admin.everyone.is.admin: "false"

# See http://readme.drone.io/0.5/manage/server/ for possible values here.
{{ if .Values.remote.github.enabled }}
  remote.github.is.enabled: "true"
  remote.github.url: {{ .Values.remote.github.url | quote }}
  remote.github.client.id: {{ .Values.remote.github.client_id | quote }}
  remote.github.client.secret: {{ .Values.remote.github.client_secret | quote }}
  remote.github.scope: {{ .Values.remote.github.scope | quote }}
  remote.github.private_mode: {{ .Values.remote.github.private_mode | quote }}
  remote.github.context: {{ .Values.remote.github.context | quote }}
  remote.github.merge_ref: {{ .Values.remote.github.merge_ref | quote }}
  remote.github.skip_verify: {{ .Values.remote.github.skip_verify | quote }}
  {{ if .Values.remote.github.git_username }}
  remote.github.git.username: {{ .Values.remote.github.git_username | quote }}
  remote.github.git.password: {{ .Values.remote.github.git_password | quote }}
  {{ end }}

{{ else if .Values.remote.gogs.enabled }}
  remote.gogs.is.enabled: "true"
  remote.gogs.url: {{ .Values.remote.gogs.url | quote }}
  remote.gogs.private_mode: {{ .Values.remote.gogs.private_mode | quote }}
  remote.gogs.skip_verify: {{ .Values.remote.gogs.skip_verify | quote  }}
  {{ if .Values.remote.gogs.git_username }}
  remote.gogs.git.username: {{ .Values.remote.gogs.git_username | quote }}
  remote.gogs.git.password: {{ .Values.remote.gogs.git_password | quote }}
  {{ end }}

{{ else if .Values.remote.gitlab.enabled }}
  remote.gitlab.is.enabled: "true"
  remote.gitlab.url: {{ .Values.remote.gitlab.url | quote }}
  remote.gitlab.client.id: {{ .Values.remote.gitlab.client_id | quote }}
  remote.gitlab.client.secret: {{ .Values.remote.gitlab.client_secret | quote }}
  remote.github.private_mode: {{ .Values.remote.gitlab.private_mode | quote }}
  remote.github.skip_verify: {{ .Values.remote.gitlab.skip_verify | quote }}
  {{ if .Values.remote.gitlab.git_username }}
  remote.github.git.username: {{ .Values.remote.gitlab.git_username | quote }}
  remote.github.git.password: {{ .Values.remote.gitlab.git_password | quote  }}
  {{ end }}

{{ else if .Values.remote.bitbucket.enabled }}
  remote.bitbucket.is.enabled: "true"
  remote.bitbucket.client.id: {{ .Values.remote.bitbucket.client_id | quote }}
  remote.bitbucket.client.secret: {{ .Values.remote.bitbucket.client_secret | quote }}

{{ else if .Values.remote.stash.enabled }}
  remote.stash.is.enabled: "true"
  remote.stash.url: {{ .Values.remote.stash.url | quote }}
  remote.stash.consumer.key: {{ .Values.remote.stash.consumer_key | quote }}
  remote.stash.consumer.rsa: {{ .Values.remote.stash.consumer_rsa | quote }}
  remote.stash.private_mode: {{ .Values.remote.stash.private_mode | quote }}
  remote.stash.skip_verify: {{ .Values.remote.stash.skip_verify | quote }}
  {{ if .Values.remote.stash.git_username }}
  remote.stash.git.username: {{ .Values.remote.stash.git_username | quote }}
  remote.stash.git.password: {{ .Values.remote.stash.git_password | quote }}
  {{ end }}
{{ end }}

  ######################
  # Drone Agent Config #
  ######################

  agent.debug.is.enabled: "true"

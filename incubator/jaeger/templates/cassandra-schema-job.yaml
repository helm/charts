apiVersion: batch/v1
kind: Job
metadata:
  name: "{{ template "jaeger.fullname" . }}-cassandra-schema"
  labels:
    app: "{{ template "jaeger.fullname" . }}-cassandra-schema"
    jaeger-infra: cassandra-schema-job
    chart: {{ .Chart.Name }}-{{ .Chart.Version | replace "+" "_" }}
    component: "{{ template "jaeger.fullname" . }}-cassandra-schema"
    heritage: "{{ .Release.Service }}"
    release: "{{ .Release.Name }}"
{{- if .Values.job.schema.annotations }}
  annotations:
{{ toYaml .Values.job.schema.annotations | indent 6 }}
{{- end }}
spec:
  activeDeadlineSeconds: 120
  template:
    metadata:
      name: "{{ template "jaeger.fullname" . }}-cassandra-schema"
    spec:
      containers:
      - name: "{{ template "jaeger.fullname" . }}-cassandra-schema"
        image: "{{ .Values.job.schema.image }}:{{ .Values.job.schema.tag }}"
        imagePullPolicy: {{ .Values.job.schema.pullPolicy }}
        env:
          - name: CQLSH_HOST
            value: "{{ template "cassandra.fullname" . }}"
          - name: MODE
            value: "{{ .Values.job.schema.mode }}"
          - name: DATACENTER
            value: "{{ .Values.cassandra.config.dc_name }}"
      restartPolicy: Never
